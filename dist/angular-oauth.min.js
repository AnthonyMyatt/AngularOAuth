!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t(require,exports,module):e.angularOAuth=t()}(this,function(e,t,n){function r(e){e.interceptors.push("oauthInterceptor")}function o(e,t,n){return{request:function(e){return e.headers=e.headers||{},!e.headers.hasOwnProperty("Authorization")&&n.getAuthorizationHeader()&&(e.headers.Authorization=n.getAuthorizationHeader()),e},responseError:function(r){return 400!==r.status||!r.data||"invalid_request"!==r.data.error&&"invalid_grant"!==r.data.error||(n.removeToken(),t.$emit("oauth:error",r)),(401===r.status&&r.data&&"invalid_token"===r.data.error||r.headers("www-authenticate")&&0===r.headers("www-authenticate").indexOf("Bearer"))&&t.$emit("oauth:error",r),e.reject(r)}}}function i(){var e;this.configure=function(t){if(e)throw new Error("Already configured.");if(!(t instanceof Object))throw new TypeError("Invalid argument: `config` must be an `Object`.");return e=angular.extend({},u,t),angular.forEach(c,function(t){if(!e[t])throw new Error("Missing parameter: "+t+".")}),"/"===e.baseUrl.substr(-1)&&(e.baseUrl=e.baseUrl.slice(0,-1)),"/"!==e.grantPath[0]&&(e.grantPath=e.grantPath),"/"!==e.revokePath[0]&&(e.revokePath=e.revokePath),e},this.$get=function(t,n,r){return new function(){if(!e)throw new Error("`OAuthProvider` must be configured first.");this.isAuthenticated=function(){return!!r.getToken()},this.getAccessToken=function(o,i){return o=angular.extend({client_id:e.clientId,grant_type:"password"},o),null!==e.clientSecret&&(o.client_secret=e.clientSecret),o=n(o),i=angular.extend({headers:{Authorization:void 0,"Content-Type":"application/x-www-form-urlencoded"}},i),t.post(e.baseUrl+e.grantPath,o,i).then(function(e){return r.setToken(e.data),e})},this.getRefreshToken=function(o,i){return o=angular.extend({client_id:e.clientId,grant_type:"refresh_token",refresh_token:r.getRefreshToken()},o),null!==e.clientSecret&&(o.client_secret=e.clientSecret),o=n(o),i=angular.extend({headers:{Authorization:void 0,"Content-Type":"application/x-www-form-urlencoded"}},i),t.post(e.baseUrl+e.grantPath,o,i).then(function(e){return r.setToken(e.data),e})},this.revokeToken=function(o,i){var a=r.getRefreshToken();return o=angular.extend({client_id:e.clientId,token:a?a:r.getAccessToken(),token_type_hint:a?"refresh_token":"access_token"},o),null!==e.clientSecret&&(o.client_secret=e.clientSecret),o=n(o),i=angular.extend({headers:{"Content-Type":"application/x-www-form-urlencoded"}},i),t.post(e.baseUrl+e.revokePath,o,i).then(function(e){return r.removeToken(),e})}}},this.$get.$inject=["$http","$httpParamSerializer","OAuthToken"]}function a(){var e={name:"token"};this.configure=function(t){if(!(t instanceof Object))throw new TypeError("Invalid argument: `config` must be an `Object`.");return angular.extend(e,t),e},this.$get=function(){return new function(){this.setToken=function(t){return window.sessionStorage.setItem(e.name,angular.toJson(t))},this.getToken=function(){return angular.fromJson(window.sessionStorage.getItem(e.name))},this.getAccessToken=function(){return this.getToken()?this.getToken().access_token:void 0},this.getAuthorizationHeader=function(){return this.getTokenType()&&this.getAccessToken()?this.getTokenType().charAt(0).toUpperCase()+this.getTokenType().substr(1)+" "+this.getAccessToken():void 0},this.getRefreshToken=function(){return this.getToken()?this.getToken().refresh_token:void 0},this.getTokenType=function(){return this.getToken()?this.getToken().token_type:void 0},this.removeToken=function(){return window.sessionStorage.removeItem(e.name)}}}}var s=angular.module("angular-oauth",[]).config(r).factory("oauthInterceptor",o).provider("OAuth",i).provider("OAuthToken",a);r.$inject=["$httpProvider"],o.$inject=["$q","$rootScope","OAuthToken"];var u={baseUrl:null,clientId:null,clientSecret:null,grantPath:"/oauth2/token",revokePath:"/oauth2/revoke"},c=["baseUrl","clientId","grantPath","revokePath"];return s});